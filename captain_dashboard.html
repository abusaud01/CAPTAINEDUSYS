<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم الكابتن</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <!-- 1. تضمين مكتبة Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* ... نفس أكواد CSS السابقة ... */
    </style>
</head>
<body>
    <!-- ... نفس هيكل HTML السابق ... -->
    
    <script>
        // --- JavaScript: The Brains ---

        // 2. إعداد الاتصال مع Supabase باستخدام مفاتيحك
        const supabaseUrl = 'https://xpeubmofhyoqupsjfalq.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhwZXVibW9maHlvcXVwc2pmYWxxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyNTM3NzgsImV4cCI6MjA3NzgyOTc-';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey );

        // --- منطق النافذة المنبثقة (Modal) ---
        // ... نفس الكود السابق ...

        // 3. استبدال المحاكاة بالاتصال الحقيقي
        async function handleAddSchool(event) {
            event.preventDefault();
            const schoolNameInput = document.getElementById('school-name-input');
            const schoolName = schoolNameInput.value.trim();

            if (schoolName) {
                console.log(`Sending to Supabase: ${schoolName}`);

                // الاتصال بـ Supabase لإضافة المدرسة إلى جدول 'schools'
                const { data, error } = await supabase
                    .from('schools')
                    .insert([
                        { name: schoolName }
                    ])
                    .select();

                if (error) {
                    console.error('Error adding school:', error.message);
                    alert('حدث خطأ أثناء إضافة المدرسة. يرجى المحاولة مرة أخرى.');
                } else {
                    console.log('School added successfully:', data);
                    // إضافة المدرسة إلى القائمة في الواجهة
                    addSchoolToList(data[0].name);
                    closeAddSchoolModal();
                }
            }
        }
        
        // ... باقي دوال JavaScript كما هي ...
    </script>
</body>
</html>
